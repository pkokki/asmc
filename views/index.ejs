<!DOCTYPE html>
<html ng-app="app" ng-controller="AppController">
<head>
  <title><%= title %></title>
  <meta name="viewport" content="initial-scale=1, maximum-scale=1">
  <style type="text/css">@charset "UTF-8";[ng\:cloak],[ng-cloak],[data-ng-cloak],[x-ng-cloak],.ng-cloak,.x-ng-cloak,.ng-hide:not(.ng-hide-animate){display:none !important;}ng\:form{display:block;}
  </style>
  <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/angular_material/0.8.2/angular-material.min.css">
  <link rel="stylesheet" href="/css/app.css" />
  <link rel="stylesheet" href="/css/materialDesignTable.css" />
  <link rel="stylesheet" href="/css/sprites/sprite-navigation-grey600.css" />
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=RobotoDraft:400,500,700,400italic">
</head>
<body layout="row" class="md-default-theme">

	<md-sidenav style="display:none1" class="site-sidenav md-sidenav-left md-whiteframe-z2" md-component-id="left" md-is-locked-open="isSidebarLocked()">
		<md-toolbar>
			<div class="md-toolbar-tools">
				<button class="docs-menu-icon" ng-show="!isSidebarLocked()" aria-label="Close Menu" ng-click="closeSidebar()">
					<div class="icon-navigation-grey600 icon-navigation-grey600-ic_close_grey600_24dp"></div>
				</button>
				<h1>Sidebar</h1>
			</div>
		</md-toolbar>
		
		<md-content class="md-padding">
			The sidebar
		</md-content>
	</md-sidenav>
	
	<div layout="column" class="md-whiteframe-z1" tabIndex="-1" role="main" flex>
		
		<md-toolbar>
			<div class="md-toolbar-tools">
				<button class="docs-menu-icon" hide-gt-md aria-label="Toggle Menu" ng-click="toggleSidebar()">
					<div class="icon-navigation-grey600 icon-navigation-grey600-ic_menu_grey600_24dp"></div>
				</button>
				<h1><%= title %></h1>
			</div>
		</md-toolbar>
			
		<md-content class="md-padding">
			<div ui-view></div>
		</md-content>
	</div>


<!-- Libraries -->
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular-animate.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular-aria.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular-messages.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular-resource.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-router/0.2.13/angular-ui-router.min.js"></script>

<script src="https://ajax.googleapis.com/ajax/libs/angular_material/0.8.2/angular-material.min.js"></script>
	
<!-- Templates -->
<script type="text/ng-template" id="/index.html">
	<h3>API routes</h3>
	<ul>
		<li><a href="/api/spaces">api/spaces</a></li>
	</ul>
	<h3>Client routes</h3>
	<ul>
		<li><a href="#/">Home</a></li>
		<li><a href="#/spaces">Spaces</a></li>
	</ul>
</script>

<script type="text/ng-template" id="/spaceList.html">
	<div class="md-padding">
		<md-input-container>
			<label>Search: </label>
			<input type="text" ng-model="search.name">
		</md-input-container>
	</div>
  
	<div class="table-responsive-vertical shadow-z-1">
	<table class="table table-striped table-hover1 table-bordered1">
	<thead>
		<tr>
		  <th>Name</th>
		  <th>Description</th>
		  <th>A</th>
		</tr>
	</thead>
	<tbody>
		<tr ng-repeat="space in spaces | filter: search">
			<td data-title="Name">
				<a ng-show="!editing[$index]" href="#/spaces/{{space._id}}">{{space.name}}</a>
				<input ng-show="editing[$index]" type="text" ng-model="space.name">
			</td>
			<td data-title="Description">
				<span ng-show="!editing[$index]">{{space.description}}</span>
				<input ng-show="editing[$index]" type="text" ng-model="space.description">
			</td>
			<td data-title="Actions">
				<md-button class="md-primary" ng-show="!editing[$index]" ng-click="edit($index)">edit</md-button>
				<md-button class="md-primary" ng-show="editing[$index]" ng-click="update($index)">Update</md-button>
				<md-button ng-show="editing[$index]" ng-click="cancel($index)">Cancel</md-button>
			</td>
		</tr>
	</tbody>
	</table>
	</div>

	<div layout="row" layout-align="left center" layout-margin layout-fill layout-padding>
		<md-input-container>
			<label>New space: </label>
			<input type="text" ng-model="newSpace.name">
		</md-input-container>
		<md-button class="md-fab md-primary" aria-label="Create" ng-click="save()">
			<md-icon md-svg-src="img/icons/android.svg"></md-icon>
		</md-button>
	</div>
</script>

<script type="text/ng-template" id="/spaceItem.html">
	<h1>{{ space.name }}</h1>
	
	<form name="spaceForm">
		<md-input-container>
			<label>Name</label>
			<input md-maxlength="30" required name="name" ng-model="space.name">
			<div ng-messages="spaceForm.description.$error">
				<div ng-message="required">This is required.</div>
				<div ng-message="md-maxlength">The name has to be less than 30 characters long.</div>
			</div>
		</md-input-container>
		<md-input-container>
			<label>Description</label>
			<input ng-model="space.description">
		</md-input-container>
	</form>

	<button ng-click="update()">Update</button>
	<a href="#/spaces">Cancel</a>
</script>

<script>
	angular.module('app', [
		'ui.router', 
		'ngResource', 
		'ngMaterial',
		'ngMessages',
	])
	
	//---------------
    // Services
    //---------------
    .factory('Spaces', ['$resource', function($resource){
		return $resource('/api/spaces/:id', null, {
			'update': { method:'PUT' }
		});
    }])
	
	//---------------
    // Controllers
    //---------------
	.controller('AppController', ['$scope', '$mdSidenav', '$mdMedia', '$log', function($scope, $mdSidenav, $mdMedia, $log) {
		$scope.toggleSidebar = function() {
			$mdSidenav('left').toggle()
				.then(function(){
					$log.debug("toggle left is done");
				});
		};
		$scope.closeSidebar = function() {
			$mdSidenav('left').close()
				.then(function(){
					$log.debug("close LEFT is done");
				});
		};
		
		$scope.isSidebarLocked = function() {
			return $mdMedia('gt-md');
		}
		$log.info('App started');
	}])
	
	.controller('SpaceListController', ['$scope', 'Spaces', function ($scope, Spaces) {
		$scope.spaces = Spaces.query();
		$scope.editing = [];
		$scope.save = function(){
			if(!$scope.newSpace.name || $scope.newSpace.name.length < 1) 
				return;
			var space = new Spaces($scope.newSpace);
			space.$save(function(){
				$scope.spaces.push(space);
				$scope.newSpace = {}; // clear values
			});
		}
		
		$scope.update = function(index){
			var space = $scope.spaces[index];
			Spaces.update({id: space._id}, space);
			$scope.editing[index] = false;
		}
		
		$scope.edit = function(index){
			$scope.editing[index] = angular.copy($scope.spaces[index]);
		}
		
		$scope.cancel = function(index){
			$scope.spaces[index] = angular.copy($scope.editing[index]);
			$scope.editing[index] = false;
		}
    }])
	
	.controller('SpaceItemController', ['$scope', '$location', '$stateParams', 'Spaces', function ($scope, $location, $stateParams, Spaces) {
		$scope.space = Spaces.get({id: $stateParams.id });
		$scope.update = function(){
			Spaces.update({id: $scope.space._id}, $scope.space, function(){
				$location.url('/spaces');
			});
		}
    }])
	
	//---------------
    // Routes
    //---------------
    .config(['$stateProvider', '$urlRouterProvider', function ($stateProvider, $urlRouterProvider) {
		$urlRouterProvider.otherwise('/home');
		
		$stateProvider
			.state('home', {
				url: '/home',
				templateUrl: '/index.html',
			})
			.state('spaceList', {
				url: '/spaces',
				templateUrl: '/spaceList.html',
				controller: 'SpaceListController'
			})
			.state('spaceItem', {
				url: '/spaces/:id',
				templateUrl: '/spaceItem.html',
				controller: 'SpaceItemController'
			})
		;
	}]);
</script>

</body>
</html>